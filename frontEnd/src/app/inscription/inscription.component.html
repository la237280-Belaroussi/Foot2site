<div class="inscription-container">
  <h2>CrÃ©er un compte</h2>
  <p class="subtitle">Vous serez automatiquement enregistrÃ© comme client</p>

  @if (successMessage()) {
    <div class="alert alert-success">{{ successMessage() }}</div>
  }

  @if (errorMessage()) {
    <div class="alert alert-danger">{{ errorMessage() }}</div>
  }

  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">

    <!-- PrÃ©nom -->
    <div class="form-group">
      <label for="firstname">PrÃ©nom *</label>
      <input
        type="text"
        id="firstname"
        formControlName="firstname"
        class="form-control"
        placeholder="Jean"
        [class.is-invalid]="firstname?.invalid && firstname?.touched">
      @if (firstname?.invalid && firstname?.touched) {
        <small class="text-danger">
          @if (firstname?.errors?.['required']) { Le prÃ©nom est requis }
          @if (firstname?.errors?.['minlength']) { Minimum 2 caractÃ¨res }
        </small>
      }
    </div>

    <!-- Nom -->
    <div class="form-group">
      <label for="lastname">Nom *</label>
      <input
        type="text"
        id="lastname"
        formControlName="lastname"
        class="form-control"
        placeholder="Dupont"
        [class.is-invalid]="lastname?.invalid && lastname?.touched">
      @if (lastname?.invalid && lastname?.touched) {
        <small class="text-danger">
          @if (lastname?.errors?.['required']) { Le nom est requis }
          @if (lastname?.errors?.['minlength']) { Minimum 2 caractÃ¨res }
        </small>
      }
    </div>

    <!-- Email -->
    <div class="form-group">
      <label for="email">Email *</label>
      <input
        type="email"
        id="email"
        formControlName="email"
        class="form-control"
        placeholder="jean.dupont@example.com"
        [class.is-invalid]="email?.invalid && email?.touched">
      @if (email?.invalid && email?.touched) {
        <small class="text-danger">
          @if (email?.errors?.['required']) { L'email est requis }
          @if (email?.errors?.['email']) { Format d'email invalide }
        </small>
      }
    </div>

    <!-- Mot de passe -->
    <div class="form-group">
      <label for="password">Mot de passe *</label>
      <div class="password-wrapper">
        <input
          [type]="showPassword() ? 'text' : 'password'"
          id="password"
          formControlName="password"
          class="form-control"
          placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
          [class.is-invalid]="password?.invalid && password?.touched">
        <button
          type="button"
          (click)="togglePasswordVisibility()"
          class="toggle-password"
          aria-label="Afficher/masquer le mot de passe">
          {{ showPassword() ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
        </button>
      </div>
      @if (password?.invalid && password?.touched) {
        <small class="text-danger">
          @if (password?.errors?.['required']) { Le mot de passe est requis }
          @if (password?.errors?.['minlength']) { Minimum 6 caractÃ¨res requis }
        </small>
      }
    </div>

    <!-- Section Adresse -->
    <fieldset class="address-section">
      <legend>Adresse de livraison</legend>

      <div class="form-row">
        <div class="form-group col-4">
          <label for="addressNumero">NÂ° *</label>
          <input
            type="text"
            id="addressNumero"
            formControlName="addressNumero"
            placeholder="42"
            class="form-control"
            [class.is-invalid]="addressNumero?.invalid && addressNumero?.touched">
          @if (addressNumero?.invalid && addressNumero?.touched) {
            <small class="text-danger">Requis</small>
          }
        </div>

        <div class="form-group col-8">
          <label for="addressRue">Rue *</label>
          <input
            type="text"
            id="addressRue"
            formControlName="addressRue"
            placeholder="Rue de la Paix"
            class="form-control"
            [class.is-invalid]="addressRue?.invalid && addressRue?.touched">
          @if (addressRue?.invalid && addressRue?.touched) {
            <small class="text-danger">Min. 3 caractÃ¨res</small>
          }
        </div>
      </div>

      <div class="form-group">
        <label for="addressCode">Code postal *</label>
        <input
          type="text"
          id="addressCode"
          formControlName="addressCode"
          placeholder="1000"
          class="form-control"
          [class.is-invalid]="addressCode?.invalid && addressCode?.touched">
        @if (addressCode?.invalid && addressCode?.touched) {
          <small class="text-danger">Code postal requis (4-5 chiffres)</small>
        }
      </div>
    </fieldset>

    <!-- Boutons -->
    <div class="form-actions">
      <button
        type="submit"
        [disabled]="loading() || registerForm.invalid"
        class="btn btn-primary">
        @if (loading()) {
          <span class="spinner"></span> Inscription en cours...
        } @else {
          S'inscrire
        }
      </button>

      <div class="link-section">
        <span>DÃ©jÃ  un compte ?</span>
        <a routerLink="/connection" class="link">Se connecter</a>
      </div>
    </div>
  </form>
</div>
